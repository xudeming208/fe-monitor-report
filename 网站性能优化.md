# 优化建议

## 前端
### 一. 打包优化
> 通过分析发现，打包完的静态资源都比较大，耗时主要在下载资源时。如果包不是很大的话，我们采取增量上线，只要不缓存HTML，其他静态资源都可以缓存

1. 去除不必要的插件。由于各种原因，打包文件包含了一大堆没必要的插件
2. 提取第三方库。各种第三方的库，变化很少，我们完全可以单独打包，并设置强缓存（expires、cache-control），如：jQuery、react等等。拆分包后势必会增加http请求，我们可以将资源上传至不同域名或cdn，增加浏览器的并行下载能力
3. 由于项目迭代、换开发等各种原因，导致代码非常混乱，可以使用Tree Shaking去掉没使用的代码

### 二、页面优化
1. 为了减少页面白屏时间，须JS放页面后端，也要注意JS处理事件效率等，减少阻塞。资源延迟加载等提高首屏展示时间
2. 减少HTTP请求数。请求数多时，为了提高浏览器的并行能力，可采用多域名及cdn，配置域名预解析
3. 图片选择合适的格式（如webp，注意优雅降级）、大小及质量，icon可以通过雪碧图、font icon及base64等方式
4. 压缩静态资源。对于敏感资源，可以采用混淆压缩
5. 页面布局应语义化，也应避免标签、css层级太深
6. 善于使用本地存储（localStorage、sessionStorage）来缓存一些配置数据，比如国家、省份等信息
7. 可以通过performance.timing和performance.getEntries()查看页面资源的请求情况
8. 写代码时，时刻注意闭包、重绘、重排等，善于启用GPU，善于使用requestAnimationFrame、createDocumentFragment等等
9. 页面静态化
10. 更多建议请参考pagespeed或者yslow

## 后端
1. 尽量减少转发代理等次数
2. 对资源设置Content-Length属性，可以让浏览器提前知道数据的多少，而无需自己去实时检测数据是否传输完毕，提高其效率。
3. 对实时性要求不高的数据做缓存
4. 尽量瘦身接口返回内容，避免将一些用不到的数据也返回前端，导致传输数据量太大
5. 增加Server-Timing响应标头，方便我们了解请求的数据各个阶段所花费的时间，比如db时间等
6. 接口缓慢原因，是否因为配置太低，太多计算耗费CPU，导致性能降低，考虑更换更高性能的服务器

## 运维
1. 可以采用http2协议。多路复用、头部压缩等等优势
2. 对静态资源启用gzip压缩，压缩等级看需求而定。注意图片别gzip压缩
3. 对于常年不变或变化很少的资源，启用强制缓存（expires、cache-control），不请求网络；其他资源可以启用协商缓存，尽量使用lastModify，301返回头部，不返回body。尽量少用eTag，比较耗CPU，一定要etag时，尽量部分内容etag，避免全量etag
4. 对于重要项目或者pv、uv高项目，采用负载均衡

## 网络
1. CDN
2. dns缓存
3. 域名预解析
4. 负载均衡